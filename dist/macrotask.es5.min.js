!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.macrotask=e.macrotask||{})}(this,function(e){"use strict";function t(e){var t=0,n=new y(e),r=f.document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}function n(){if(!f.postMessage||f.importScripts)return!1;if(f.setImmediate)return!1;var e=!0,t=f.onmessage;return f.onmessage=function(){e=!1},f.postMessage("","*"),f.onmessage=t,e}function r(e){function t(t){t.source===f&&t.data===n&&e()}var n="com.calvinmetcalf.setImmediate"+Math.random();return f.addEventListener?f.addEventListener("message",t,!1):f.attachEvent("onmessage",t),function(){f.postMessage(n,"*")}}function i(){return!f.setImmediate&&"undefined"!=typeof f.MessageChannel}function u(e){var t=new f.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}function a(e){return function(){setTimeout(e,0)}}function o(){if(!A.length)return void(D=!1);for(var e=A.shift();e.canceled;){if(!A.length)return void(D=!1);e=A.shift()}var t=e.run();if(A.length?K():D=!1,t)throw t}function s(e){A.push(e),D||(K||(K=I(o)),D=!0,K())}function c(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=new P(e,n);return C.set(i.token,i),s(i),i.token}function l(e){if(C.has(e)){var t=C.get(e);return t.cancel(),!0}return!1}var f="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},h=!0,v=function(){return!h&&f&&"function"==typeof f.setImmediate},d=function(e){return function(){return f.setImmediate(e)}},p=Object.freeze({test:v,install:d}),y=f.MutationObserver||f.WebKitMutationObserver,m=function(){return y},g=Object.freeze({test:m,install:t}),k=Object.freeze({test:n,install:r}),b=Object.freeze({test:i,install:u}),w=function(){return"document"in f&&"onreadystatechange"in f.document.createElement("script")},x=function(e){return function(){var t=f.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},f.document.documentElement.appendChild(t),e}},j=Object.freeze({test:w,install:x}),M=function(){return!0},O=Object.freeze({test:M,install:a}),E=[p,g,k,b,j,O],I=function(e){var t=!0,n=!1,r=void 0;try{for(var i,u=E[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var a=i.value;if(a.test())return a.install(e)}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}},z=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var o={key:e,arg:t,resolve:n,reject:i,next:null};a?a=a.next=o:(u=a=o,r(e,t))})}function r(n,u){try{var a=t[n](u),o=a.value;o instanceof e?Promise.resolve(o.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":u.resolve({value:t,done:!0});break;case"throw":u.reject(t);break;default:u.resolve({value:t,done:!1})}u=u.next,u?r(u.key,u.arg):a=null}var u,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=function e(){z(this,e)},C=new WeakMap,P=function(){function e(t,n){z(this,e),this.fun=t,this.array=n,this.canceled=!1,this.token=new _}return S(e,[{key:"run",value:function(){if(this.canceled)return!1;var e=this.fun,t=this.array,n=!1;try{switch(t.length){case 0:e();break;case 1:e(t[0]);break;case 2:e(t[0],t[1]);break;case 3:e(t[0],t[1],t[2]);break;default:e.apply(null,t)}}catch(e){n=e}finally{C.delete(this.token)}return n}},{key:"cancel",value:function(){this.canceled=!0,C.delete(this.token)}}]),e}(),T=function e(t){z(this,e),this.prev=null,this.next=null,this.value=t},L=function(){function e(){z(this,e)}return S(e,[{key:"construtor",value:function(e,t){this.value=e,this.done=!!t}}]),e}(),N=function(){function e(){z(this,e)}return S(e,[{key:"construtor",value:function(e){this.current=e}},{key:"next",value:function(){if(this.current){var e=this.current;return this.current=this.current.next,L(e.value)}return L(void 0,!0)}}]),e}(),W=function(){function e(){z(this,e),this.length=0,this.head=null,this.tail=null}return S(e,[{key:"push",value:function(e){var t=new T(e);if(this.length>0){var n=this.tail;n.next=t,t.prev=n,this.tail=t}else this.head=this.tail=t;return this.length++,this.length}},{key:"pop",value:function(){if(!(this.length<1)){var e=this.tail;if(1===this.length)this.head=this.tail=null;else{var t=e.prev;t.next=null,this.tail=t}return this.length--,e.value}}},{key:"unshift",value:function(e){var t=new T(e);if(this.length>0){var n=this.head;n.prev=t,t.next=n,this.head=t}else this.head=this.tail=t;return this.length++,this.length}},{key:"shift",value:function(){if(!(this.length<1)){var e=this.head;if(1===this.length)this.head=this.tail=null;else{var t=e.next;t.prev=null,this.head=t}return this.length--,e.value}}},{key:Symbol.iterator,value:function(){return new N(this.head)}}]),e}(),A=new W,D=!1,K=void 0;e.run=c,e.clear=l,Object.defineProperty(e,"__esModule",{value:!0})});
