{"version":3,"file":"macrotask.cjs.js","sources":["../lib/async/setImmediate.js","../lib/async/postMessage.js","../lib/async/messageChannel.js","../lib/async/stateChange.js","../lib/async/timeout.js","../lib/nextTick.js","../lib/item.js","../lib/list.js","../lib/index.js"],"sourcesContent":["export const test = () => !process.browser && global && typeof global.setImmediate === 'function';\n\nexport const install = func => () => global.setImmediate(func);\n","// The test against `importScripts` prevents this implementation from being installed inside a web worker,\n// where `global.postMessage` means something completely different and can't be used for this purpose.\n\nexport function test() {\n  if (!global.postMessage || global.importScripts) {\n    return false;\n  }\n  if (global.setImmediate) {\n    // we can only get here in IE10\n    // which doesn't handel postMessage well\n    return false;\n  }\n  var postMessageIsAsynchronous = true;\n  var oldOnMessage = global.onmessage;\n  global.onmessage = function () {\n    postMessageIsAsynchronous = false;\n  };\n  global.postMessage('', '*');\n  global.onmessage = oldOnMessage;\n\n  return postMessageIsAsynchronous;\n};\n\nexport function install (func) {\n  var codeWord = 'com.calvinmetcalf.setImmediate' + Math.random();\n  function globalMessage(event) {\n    if (event.source === global && event.data === codeWord) {\n      func();\n    }\n  }\n  if (global.addEventListener) {\n    global.addEventListener('message', globalMessage, false);\n  } else {\n    global.attachEvent('onmessage', globalMessage);\n  }\n  return function () {\n    global.postMessage(codeWord, '*');\n  };\n};\n","\nexport function test() {\n  if (global.setImmediate) {\n    // we can only get here in IE10\n    // which doesn't handel postMessage well\n    return false;\n  }\n  return typeof global.MessageChannel !== 'undefined';\n};\n\nexport function install(func) {\n  var channel = new global.MessageChannel();\n  channel.port1.onmessage = func;\n  return function () {\n    channel.port2.postMessage(0);\n  };\n};\n","\nexport const test = () =>\n  'document' in global && 'onreadystatechange' in global.document.createElement('script');\n\nexport const install = handle => function () {\n\n    // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n    // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n    var scriptEl = global.document.createElement('script');\n    scriptEl.onreadystatechange = function () {\n      handle();\n\n      scriptEl.onreadystatechange = null;\n      scriptEl.parentNode.removeChild(scriptEl);\n      scriptEl = null;\n    };\n    global.document.documentElement.appendChild(scriptEl);\n\n    return handle;\n  };\n","export const test =  () => true;\n\nexport function install(t) {\n  return function () {\n    setTimeout(t, 0);\n  };\n};\n","import * as setImmediate from './async/setImmediate';\nimport * as postMessage from './async/postMessage';\nimport * as messageChannel from './async/messageChannel';\nimport * as stateChange from './async/stateChange';\nimport * as timeout from './async/timeout';\n\nvar types = [\n  setImmediate,\n  postMessage,\n  messageChannel,\n  stateChange,\n  timeout\n];\nexport default function (drainQueue) {\n  for (let type of types) {\n    if (type.test()) {\n      return type.install(drainQueue);\n    }\n  }\n}\n","class CancelToken{}\nfunction throwStuff(e) {\n  throw e;\n}\n// v8 likes predictible objects\nexport class Item {\n  constructor(fun, array, list) {\n    this.fun = fun;\n    this.array = array;\n    this.token = new CancelToken();\n    this.prev = null;\n    this.next = null;\n    this.list = list;\n  }\n  run() {\n    const fun = this.fun;\n    const array = this.array;\n    switch (array.length) {\n      case 0:\n        fun();\n        break;\n      case 1:\n        fun(array[0]);\n        break;\n      case 2:\n        fun(array[0], array[1]);\n        break;\n      case 3:\n        fun(array[0], array[1], array[2]);\n        break;\n      default:\n        fun(...array);\n        break;\n    }\n  }\n  cancel() {\n    const next = this.next;\n    const prev = this.prev;\n    if (next === null) {\n      if (prev === null) {\n        // only thing on list\n        if (this.list.head === this && this.list.length === 1) {\n          // sanity check\n          this.list.head = this.list.tail = null;\n        } else {\n          return;\n        }\n      } else {\n        prev.next = null;\n        this.list.tail = prev;\n        // tail of list\n      }\n    } else {\n      if (prev === null) {\n        // head of list\n        next.prev = null;\n        this.list.head = next;\n      } else {\n        // middle of list\n        prev.next = next;\n        next.prev = prev;\n      }\n    }\n    this.list.length--;\n  }\n}\n","import {Item} from './item';\n\nexport class List {\n  constructor() {\n    this.length = 0;\n    this.head = null;\n    this.tail = null;\n    this.cache = new WeakMap();\n  }\n  push(func, args) {\n    const item = new Item(func, args, this);\n    if (this.length > 0) {\n      const currentTail = this.tail;\n      currentTail.next = item;\n      item.prev = currentTail;\n      this.tail = item;\n    } else {\n      this.head = this.tail = item;\n    }\n    this.length++;\n    this.cache.set(item.token, item);\n    return item.token;\n  }\n  shift() {\n    if (this.length < 1) {\n      return;\n    }\n    const item = this.head;\n    if (this.length === 1) {\n        this.head = this.tail = null;\n    } else {\n      const newHead = item.next;\n      newHead.prev = null;\n      this.head = newHead;\n    }\n    this.length--;\n    this.cache.delete(item.token);\n    return item;\n  }\n  cancel(token) {\n    const item = this.cache.get(token);\n    if (item) {\n      this.cache.delete(token);\n    } else {\n      return false;\n    }\n    item.cancel();\n    return true;\n  }\n}\n","import creatNextTick from './nextTick';\nimport {List} from './list';\nconst list = new List();\nlet inProgress = false;\nlet nextTick;\nfunction drainQueue() {\n  if (!list.length) {\n    inProgress = false;\n    return;\n  }\n  let task = list.shift();\n  if (!list.length) {\n    inProgress = false;\n  } else {\n     nextTick();\n  }\n  task.run();\n}\n\nexport function run (task, ...args) {\n  const token = list.push(task, args);\n  if (inProgress) {\n    return token;\n  }\n  if (!nextTick) {\n    nextTick = creatNextTick(drainQueue);\n  }\n  inProgress = true;\n  nextTick();\n  return token;\n};\nexport function clear (token) {\n  return list.cancel(token);\n};\n"],"names":["test","install"],"mappings":"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"}