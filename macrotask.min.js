!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.macrotask=t.macrotask||{})}(this,function(t){"use strict";function e(){if(!l.postMessage||l.importScripts)return!1;if(l.setImmediate)return!1;var t=!0,e=l.onmessage;return l.onmessage=function(){t=!1},l.postMessage("","*"),l.onmessage=e,t}function n(t){function e(e){e.source===l&&e.data===n&&t()}var n="com.calvinmetcalf.setImmediate"+Math.random();return l.addEventListener?l.addEventListener("message",e,!1):l.attachEvent("onmessage",e),function(){l.postMessage(n,"*")}}function r(){return!l.setImmediate&&"undefined"!=typeof l.MessageChannel}function i(t){var e=new l.MessageChannel;return e.port1.onmessage=t,function(){e.port2.postMessage(0)}}function o(t){return function(){setTimeout(t,0)}}function s(){if(!_.length)return void(S=!1);var t=_.shift();_.length?P():S=!1,t.run()}function a(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=_.push(t,n);return S?i:(P||(P=M(s)),S=!0,P(),i)}function u(t){return _.cancel(t)}var l="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},c=!0,f=function(){return!c&&l&&"function"==typeof l.setImmediate},h=function(t){return function(){return l.setImmediate(t)}},d=Object.freeze({test:f,install:h}),p=Object.freeze({test:e,install:n}),v=Object.freeze({test:r,install:i}),m=function(){return"document"in l&&"onreadystatechange"in l.document.createElement("script")},y=function(t){return function(){var e=l.document.createElement("script");return e.onreadystatechange=function(){t(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},l.document.documentElement.appendChild(e),t}},g=Object.freeze({test:m,install:y}),w=function(){return!0},b=Object.freeze({test:w,install:o}),k=function(){return"function"==typeof l.requestIdleCallback},x=function(t){return function(){return l.requestIdleCallback(t)}},j=Object.freeze({test:k,install:x}),I=[d,j,p,v,g,b],M=function(t){for(var e=0;e<I.length;e++){var n=I[e];if(n.test())return n.install(t)}},C=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,i){var a={key:t,arg:e,resolve:n,reject:i,next:null};s?s=s.next=a:(o=s=a,r(t,e))})}function r(n,o){try{var s=e[n](o),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){r("next",t)},function(t){r("throw",t)}):i(s.done?"return":"normal",s.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}o=o.next,o?r(o.key,o.arg):s=null}var o,s;this._invoke=n,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),E=function t(){C(this,t)},O=function(){function t(e,n,r){C(this,t),this.fun=e,this.array=n,this.token=new E,this.prev=null,this.next=null,this.list=r}return t.prototype.run=function(){var t=this.fun,e=this.array;switch(e.length){case 0:t();break;case 1:t(e[0]);break;case 2:t(e[0],e[1]);break;case 3:t(e[0],e[1],e[2]);break;default:t.apply(void 0,e)}},t.prototype.cancel=function(){var t=this.next,e=this.prev;if(null===t)if(null===e){if(this.list.head!==this||1!==this.list.length)return;this.list.head=this.list.tail=null}else e.next=null,this.list.tail=e;else null===e?(t.prev=null,this.list.head=t):(e.next=t,t.prev=e);this.list.length--},t}(),z=function(){function t(){C(this,t),this.length=0,this.head=null,this.tail=null,this.cache=new WeakMap}return t.prototype.push=function(t,e){var n=new O(t,e,this);if(this.length>0){var r=this.tail;r.next=n,n.prev=r,this.tail=n}else this.head=this.tail=n;return this.length++,this.cache.set(n.token,n),n.token},t.prototype.shift=function(){if(!(this.length<1)){var t=this.head;if(1===this.length)this.head=this.tail=null;else{var e=t.next;e.prev=null,this.head=e}return this.length--,this.cache.delete(t.token),t}},t.prototype.cancel=function(t){var e=this.cache.get(t);return!!e&&(this.cache.delete(t),e.cancel(),!0)},t}(),_=new z,S=!1,P=void 0;t.run=a,t.clear=u,Object.defineProperty(t,"__esModule",{value:!0})});
