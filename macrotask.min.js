!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.macrotask=e.macrotask||{})}(this,function(e){"use strict";function t(){if(!l.postMessage||l.importScripts)return!1;if(l.setImmediate)return!1;var e=!0,t=l.onmessage;return l.onmessage=function(){e=!1},l.postMessage("","*"),l.onmessage=t,e}function n(e){function t(t){t.source===l&&t.data===n&&e()}var n="com.calvinmetcalf.setImmediate"+Math.random();return l.addEventListener?l.addEventListener("message",t,!1):l.attachEvent("onmessage",t),function(){l.postMessage(n,"*")}}function r(){return!l.setImmediate&&"undefined"!=typeof l.MessageChannel}function i(e){var t=new l.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}function a(e){return function(){setTimeout(e,0)}}function o(){if(!z.length)return void(A=!1);for(var e=z.shift();e.canceled;){if(!z.length)return void(A=!1);e=z.shift()}z.length?C():A=!1,e.run()}function u(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=z.push(e,n);return A?i:(C||(C=x(o)),A=!0,C(),i)}function s(e){return z.cancel(e)}var l="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},c=!0,f=function(){return!c&&l&&"function"==typeof l.setImmediate},h=function(e){return function(){return l.setImmediate(e)}},d=Object.freeze({test:f,install:h}),v=Object.freeze({test:t,install:n}),p=Object.freeze({test:r,install:i}),y=function(){return"document"in l&&"onreadystatechange"in l.document.createElement("script")},m=function(e){return function(){var t=l.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},l.document.documentElement.appendChild(t),e}},g=Object.freeze({test:y,install:m}),k=function(){return!0},w=Object.freeze({test:k,install:a}),b=[d,v,p,g,w],x=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=b[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if(o.test())return o.install(e)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},j=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var u={key:e,arg:t,resolve:n,reject:i,next:null};o?o=o.next=u:(a=o=u,r(e,t))})}function r(n,a){try{var o=t[n](a),u=o.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(o.done?"return":"normal",o.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}a=a.next,a?r(a.key,a.arg):o=null}var a,o;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),M=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},I=function e(){j(this,e)},O=function(){function e(t,n,r){j(this,e),this.fun=t,this.array=n,this.token=new I,this.prev=null,this.next=null,this.list=r}return M(e,[{key:"run",value:function(){var e=this.fun,t=this.array;switch(t.length){case 0:e();break;case 1:e(t[0]);break;case 2:e(t[0],t[1]);break;case 3:e(t[0],t[1],t[2]);break;default:e.apply(void 0,E(t))}}},{key:"cancel",value:function(){var e=this.next,t=this.prev;if(null===e)if(null===t){if(this.list.head!==this||1!==this.list.length)return;this.list.head=this.list.tail=null}else t.next=null,this.list.tail=t;else null===t?(e.prev=null,this.list.head=e):(t.next=e,e.prev=t);this.list.length--}}]),e}(),_=function(){function e(){j(this,e),this.length=0,this.head=null,this.tail=null,this.cache=new WeakMap}return M(e,[{key:"push",value:function(e,t){var n=new O(e,t,this);if(this.length>0){var r=this.tail;r.next=n,n.prev=r,this.tail=n}else this.head=this.tail=n;return this.length++,this.cache.set(n.token,n),n.token}},{key:"shift",value:function(){if(!(this.length<1)){var e=this.head;if(1===this.length)this.head=this.tail=null;else{var t=e.next;t.prev=null,this.head=t}return this.length--,this.cache.delete(e.token),e}}},{key:"cancel",value:function(e){var t=this.cache.get(e);return!!t&&(this.cache.delete(e),t.cancel(),!0)}}]),e}(),z=new _,A=!1,C=void 0;e.run=u,e.clear=s,Object.defineProperty(e,"__esModule",{value:!0})});
